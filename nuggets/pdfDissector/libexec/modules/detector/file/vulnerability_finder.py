from com.zynamics.pdf.api import PdfFileHelpers
from com.zynamics.pdf.api import Interpreter
from com.zynamics.pdf.api import VulnerabilityFinder
from java.lang import String
from modules.utils import *

import re

cve_map = {
      'CVE-2009-4324': 'Doc.media.newPlayer use-after-free exploit attempt',
      'CVE-2010-0188': 'Adobe Reader malformed TIFF remote code execution attempt',
      'CVE-2010-0195': 'Adobe Reader PDF Document Embedded TrueType Font Handling Arbitrary Code Execution' 
      }


class VulnerabilityCheck():
   def __init__(self, pdf, data):
      self.pdf = pdf
      self.data = data

   def check(self):
      for vuln in VulnerabilityFinder.find(self.pdf):
         m = re.search('(CVE_[0-9]+_[0-9]+)', vuln, re.IGNORECASE | re.MULTILINE | re.DOTALL)

         if m:
            cve = m.group(0).replace('_', '-')
      
            try:
               alert("[%s] %s" % (cve, cve_map[cve]), '')
            except:
               print "ALERT: [%s] Unknown attack detected" % cve
            

